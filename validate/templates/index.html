{% load static %}
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Signup</title>
    
</head>
<body>
    <h2>Signup</h2>
    <input type="email" id="useremail" placeholder="Enter Email" required><br>
    <input type="password" id="password" placeholder="Enter Password" required><br>
    <button onclick="sendOTP()">Signup</button>

    <div id="otp-section" style="display:none;">
        <input type="text" id="otp" placeholder="Enter OTP"><br>
        <button onclick="verifyOTP()">Verify OTP</button>
    </div>
    <script src="{% static 'index.js' %}"defer>
        function sendOTP() {
            let useremail = document.getElementById("useremail").value;
            let password = document.getElementById("password").value;

            fetch("/signup/", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: `useremail=${useremail}&password=${password}`,
            })
            .then(response => response.text())
            .then(data => {
                console.log("Raw response:", data);
                alert(data.message);
                if (data.message.includes("OTP sent")) {
                    document.getElementById("otp-section").style.display = "block";
                } else {
                    alert(data.message);
                } catch (e) {
                    console.error("JSON Parse Error:", e);
                    alert("Server error! Check console.");
                }
            });
            .catch(error => console.error("Fetch error:", error));
        }

        function verifyotp() {
            let useremail = document.getElementById("email").value;
            let password = document.getElementById("password").value;
            let otp = document.getElementById("otp").value;

            fetch("/verify-otp/", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: `useremail=${useremail}&password=${password}&otp=${otp}`
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                if (data.message === "Signup successful!") {
                    window.location.href = "/login/";
                }
            });
        }
    </script>
</body>
</html>
